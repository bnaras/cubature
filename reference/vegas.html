<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Integration by a Monte Carlo Algorithm — vegas • cubature</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Integration by a Monte Carlo Algorithm — vegas"><meta name="description" content="Implement a Monte Carlo algorithm for multidimensional numerical
integration.  This algorithm uses importance sampling as a
variance-reduction technique. Vegas iteratively builds up a
piecewise constant weight function, represented on a rectangular
grid. Each iteration consists of a sampling step followed by a
refinement of the grid."><meta property="og:description" content="Implement a Monte Carlo algorithm for multidimensional numerical
integration.  This algorithm uses importance sampling as a
variance-reduction technique. Vegas iteratively builds up a
piecewise constant weight function, represented on a rectangular
grid. Each iteration consists of a sampling step followed by a
refinement of the grid."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cubature</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cubature.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/version2.html">Version 2.0 Notes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bnaras/cubature/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Integration by a Monte Carlo Algorithm</h1>
      <small class="dont-index">Source: <a href="https://github.com/bnaras/cubature/blob/main/R/vegas.R" class="external-link"><code>R/vegas.R</code></a></small>
      <div class="d-none name"><code>vegas.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implement a Monte Carlo algorithm for multidimensional numerical
integration.  This algorithm uses importance sampling as a
variance-reduction technique. Vegas iteratively builds up a
piecewise constant weight function, represented on a rectangular
grid. Each iteration consists of a sampling step followed by a
refinement of the grid.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">vegas</span><span class="op">(</span></span>
<span>  <span class="va">f</span>,</span>
<span>  nComp <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  <span class="va">lowerLimit</span>,</span>
<span>  <span class="va">upperLimit</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  relTol <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  absTol <span class="op">=</span> <span class="fl">1e-12</span>,</span>
<span>  minEval <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  maxEval <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span>,</span>
<span>  flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="fl">0L</span>, final <span class="op">=</span> <span class="fl">1L</span>, smooth <span class="op">=</span> <span class="fl">0L</span>, keep_state <span class="op">=</span> <span class="fl">0L</span>, load_state <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>    level <span class="op">=</span> <span class="fl">0L</span><span class="op">)</span>,</span>
<span>  rngSeed <span class="op">=</span> <span class="fl">12345L</span>,</span>
<span>  nVec <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  nStart <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  nIncrease <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  nBatch <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  gridNo <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  stateFile <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>The function (integrand) to be integrated as in
<code><a href="cuhre.html">cuhre()</a></code>. Optionally, the function can take two
additional arguments in addition to the variable being
integrated: - <code>cuba_weight</code> which is the weight of the
point being sampled, - <code>cuba_iter</code> the current iteration
number. The function author may choose to use these in any
appropriate way or ignore them altogether.</p></dd>


<dt id="arg-ncomp">nComp<a class="anchor" aria-label="anchor" href="#arg-ncomp"></a></dt>
<dd><p>The number of components of f, default 1, bears no
relation to the dimension of the hypercube over which
integration is performed.</p></dd>


<dt id="arg-lowerlimit">lowerLimit<a class="anchor" aria-label="anchor" href="#arg-lowerlimit"></a></dt>
<dd><p>The lower limit of integration, a vector for
hypercubes.</p></dd>


<dt id="arg-upperlimit">upperLimit<a class="anchor" aria-label="anchor" href="#arg-upperlimit"></a></dt>
<dd><p>The upper limit of integration, a vector for
hypercubes.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>All other arguments passed to the function f.</p></dd>


<dt id="arg-reltol">relTol<a class="anchor" aria-label="anchor" href="#arg-reltol"></a></dt>
<dd><p>The maximum tolerance, default 1e-5.</p></dd>


<dt id="arg-abstol">absTol<a class="anchor" aria-label="anchor" href="#arg-abstol"></a></dt>
<dd><p>the absolute tolerance, default 1e-12.</p></dd>


<dt id="arg-mineval">minEval<a class="anchor" aria-label="anchor" href="#arg-mineval"></a></dt>
<dd><p>the minimum number of function evaluations required</p></dd>


<dt id="arg-maxeval">maxEval<a class="anchor" aria-label="anchor" href="#arg-maxeval"></a></dt>
<dd><p>The maximum number of function evaluations needed,
default 10^6.  Note that the actual number of function
evaluations performed is only approximately guaranteed not to
exceed this number.</p></dd>


<dt id="arg-flags">flags<a class="anchor" aria-label="anchor" href="#arg-flags"></a></dt>
<dd><p>flags governing the integration. The list here is
exhaustive to keep the documentation and invocation uniform,
but not all flags may be used for a particular method as noted
below.  List components:</p><dl><dt>verbose</dt>
<dd><p>encodes the verbosity level, from 0 (default) to 3.  Level 0 does not print any output, level 1 prints reasonable information on the progress of the integration, level 2 also echoes the input parameters, and level 3 further prints the subregion results.</p></dd>

<dt>final</dt>
<dd><p>when 0, all sets of samples collected on a subregion during the various iterations or phases contribute to the final result.  When 1, only the last (largest) set of samples is used in the final result.</p></dd>

<dt>smooth</dt>
<dd><p>Applies to Suave and Vegas only. When 0, apply additional smoothing to the importance function, this moderately improves convergence for many integrands.  When 1, use the importance function without smoothing, this should be chosen if the integrand has sharp edges.</p></dd>

<dt>keep_state</dt>
<dd><p>when nonzero, retain state file if argument <code>stateFile</code> is non-null, else delete <code>stateFile</code> if specified.</p></dd>

<dt>load_state</dt>
<dd><p>Applies to Vegas only. Reset the integrator state even if a state file is present, i.e. keep only the grid. Together with <code>keep_state</code> this allows a grid adapted by one integration to be used for another integrand.</p></dd>

<dt>level</dt>
<dd><p>applies only to Divonne, Suave and Vegas. When <code>0</code>, Mersenne Twister random numbers are used. When nonzero Ranlux random numbers are used, except when <code>rngSeed</code> is zero which forces use of Sobol quasi-random numbers. Ranlux implements Marsaglia and Zaman's 24-bit RCARRY algorithm with generation period \(p\), i.e. for every 24 generated numbers used, another \(p-24\) are skipped. The luxury level for the Ranlux generator may be encoded in <code>level</code> as follows:</p><dl><dt>Level 1 (p = 48)</dt>
<dd><p>gives very long period, passes the gap test but fails spectral test</p></dd>

<dt>Level 2 (p = 97)</dt>
<dd><p>passes all known tests, but theoretically still defective</p></dd>

<dt>Level 3 (p = 223)</dt>
<dd><p>any theoretically possible correlations have very small chance of being observed</p></dd>

<dt>Level 4 (p = 389)</dt>
<dd><p>highest possible luxury, all 24 bits chaotic</p></dd>

<dt>Levels 5-23</dt>
<dd><p>default to 3, values above 24 directly specify the period p. Note that Ranlux's original level 0, (mis)used for selecting Mersenne Twister in Cuba, is equivalent to <code>level = 24</code></p></dd>

</dl></dd>

</dl></dd>


<dt id="arg-rngseed">rngSeed<a class="anchor" aria-label="anchor" href="#arg-rngseed"></a></dt>
<dd><p>seed, default 0, for the random number
generator. Note the articulation with <code>level</code> settings for
<code>flag</code></p></dd>


<dt id="arg-nvec">nVec<a class="anchor" aria-label="anchor" href="#arg-nvec"></a></dt>
<dd><p>the number of vectorization points, default 1, but can
be set to an integer &gt; 1 for vectorization, for example, 1024
and the function f above needs to handle the vector of points
appropriately. See vignette examples.</p></dd>


<dt id="arg-nstart">nStart<a class="anchor" aria-label="anchor" href="#arg-nstart"></a></dt>
<dd><p>the number of integrand evaluations per iteration to
start with.</p></dd>


<dt id="arg-nincrease">nIncrease<a class="anchor" aria-label="anchor" href="#arg-nincrease"></a></dt>
<dd><p>the increase in the number of integrand
evaluations per iteration. The j-th iteration evaluates the
integrand at nStart+(j-1)*nincrease points.</p></dd>


<dt id="arg-nbatch">nBatch<a class="anchor" aria-label="anchor" href="#arg-nbatch"></a></dt>
<dd><p>Vegas samples points not all at once, but in batches
of a predetermined size, to avoid excessive memory
consumption. <code>nbatch</code> is the number of points sampled in
each batch. Tuning this number should usually not be necessary
as performance is affected significantly only as far as the
batch of samples fits into the CPU cache.</p></dd>


<dt id="arg-gridno">gridNo<a class="anchor" aria-label="anchor" href="#arg-gridno"></a></dt>
<dd><p>an integer.  Vegas may accelerate convergence to keep
the grid accumulated during one integration for the next one,
if the integrands are reasonably similar to each other. Vegas
maintains an internal table with space for ten grids for this
purpose.  If <code>gridno</code> is a number between 1 and 10, the
grid is not discarded at the end of the integration, but stored
in the respective slot of the table for a future
invocation. The grid is only re-used if the dimension of the
subsequent integration is the same as the one it originates
from. In repeated invocations it may become necessary to flush
a slot in memory. In this case the negative of the grid number
should be set. Vegas will then start with a new grid and also
restore the grid number to its positive value, such that at the
end of the integration the grid is again stored in the
indicated slot.</p></dd>


<dt id="arg-statefile">stateFile<a class="anchor" aria-label="anchor" href="#arg-statefile"></a></dt>
<dd><p>the name of an external file. Vegas can store its
entire internal state (i.e. all the information to resume an
interrupted integration) in an external file.  The state file
is updated after every iteration. If, on a subsequent
invocation, Vegas finds a file of the specified name, it loads
the internal state and continues from the point it left
off. Needless to say, using an existing state file with a
different integrand generally leads to wrong results. Once the
integration finishes successfully, i.e. the prescribed accuracy
is attained, the state file is removed. This feature is useful
mainly to define ‘check-points’ in long-running
integrations from which the calculation can be restarted.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with components:</p><dl><dt>neval</dt>
<dd><p>the actual number
of integrand evaluations needed</p></dd>
 <dt>returnCode</dt>
<dd><p>if zero,
the desired accuracy was reached, if -1,
dimension out of range, if 1, the accuracy goal was not met
within the allowed maximum number of integrand evaluations.</p></dd>

<dt>integral</dt>
<dd><p>vector of length <code>nComp</code>; the integral of
<code>integrand</code> over the hypercube</p></dd>
 <dt>error</dt>
<dd><p>vector of
length <code>nComp</code>; the presumed absolute error of
<code>integral</code></p></dd>
 <dt>prob</dt>
<dd><p>vector of length <code>nComp</code>;
the \(\chi^2\)-probability (not the
\(\chi^2\)-value itself!) that <code>error</code> is not a
reliable estimate of the true integration error.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See details in the documentation.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>G. P. Lepage (1978) A new algorithm for adaptive
multidimensional integration. <em>J. Comput. Phys.</em>, <b>27</b>, 192-210.</p>
<p>G. P. Lepage (1980) VEGAS - An adaptive multi-dimensional integration
program. Research Report CLNS-80/447. Cornell University, Ithaca, N.-Y.</p>
<p>T. Hahn (2005) CUBA-a library for multidimensional numerical integration.
<em>Computer Physics Communications</em>, <b>168</b>, 78-95.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="cuhre.html">cuhre()</a></code>, <code><a href="suave.html">suave()</a></code>, <code><a href="divonne.html">divonne()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">integrand</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">arg</span>, <span class="va">weight</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">arg</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">arg</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">arg</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># end integrand</span></span></span>
<span class="r-in"><span><span class="fu">vegas</span><span class="op">(</span><span class="va">integrand</span>, lowerLimit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, upperLimit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             relTol<span class="op">=</span><span class="fl">1e-3</span>,  absTol<span class="op">=</span><span class="fl">1e-12</span>,</span></span>
<span class="r-in"><span>             flags<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbose<span class="op">=</span><span class="fl">2</span>, final<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $integral</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6652311</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0006170268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $neval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 13500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $prob</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6053001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $returnCode</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://statistics.stanford.edu/people/balasubramanian-narasimhan" class="external-link">Balasubramanian Narasimhan</a>, <a href="https://math.mit.edu/~stevenj/" class="external-link">Steven G. Johnson</a>, <a href="https://wwwth.mpp.mpg.de/members/hahn/" class="external-link">Thomas Hahn</a>, Annie Bouvier, Kiên Kiêu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

